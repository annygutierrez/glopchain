<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const SHA256 = require('crypto-js/sha256');

class Block {

  /**
   * The index is optional and it tell us where the block is on the chain.
   * The timestamp tell us when the block was created.
   * Data includes any type of data that you want to associate with the block -How much money was transfered and who is the sender and the reciver.
   * The previous hash is a string that contains the hash of the block before this one - This is very important and ensures the importance of the blockchain.
   * @constructs Block
   * @param {number} index - Block number.
   * @param {timestamp} timestamp - Creation date.
   * @param {object} data - Attach information.
   * @param {string} previousHash - Previous hash: Latest block hash.
   */
  constructor(index, timestamp, data, previousHash = '') {
    this.index = index;
    this.timestamp = timestamp;
    this.data = data;
    this.previousHash = previousHash;
    this.hash = this.calculateHash();
  }

  /**
   * @function calculateHash
   * @returns {string} Hash SHA256: block number + previous hash + timestamp + data.toString()
   */
  calculateHash() {
    return SHA256(this.index + this.previousHash + this.timestamp + JSON.stringify(this.data)).toString();
  }
}

class Blockchain {

  /**
   * This would be an array of blocks.
   * The first block on a blockchain is called a GENESIS block and it should be added manually.
   * @constructs Blockchain
   */
  constructor() {
    this.chain = [this.createGenesisBlock()];
  }
  
  /**
   * @function createGenesisBlock
   * @returns {object} Create a block inside the blockchain.
   */
  createGenesisBlock() {
    return new Block(0, "11/03/2019", "Genesis block", "0");
  }
  
  /**
   * @function getLatestBlock
   * @returns {object} Returns the latest or current block of the blockchain.
   */
  getLatestBlock() {
    return this.chain[this.chain.length - 1];
  }
  
  /**
   * @function addBlock
   * @param {object} newBlock - Add a new block to the blockchain.
   */
  addBlock(newBlock) {
    // Set the previous block to the last block on the chain
    newBlock.previousHash = this.getLatestBlock().hash;
    //  We need to recalculate its hash, so everytime we change any of its properties
    // in our block the hash function should be changed as well
    newBlock.hash = newBlock.calculateHash();
    this.chain.push(newBlock);
  }

  /**
   * To verify the integrity of our blockchain
   * @function isChainValid
   * @returns {boolean} A boolean value to verify if the current and previuos hash of each block are correct.
   */
  isChainValid() {
    // We are NOT going to start with block 0 because block 0 is a genesis block
    for (let i = 1; i &lt; this.chain.length; i++) {
      const currentBlock = this.chain[i];
      const previousBlock = this.chain[i - 1];

      // Check if the hash of the block is still valid
      if (currentBlock.hash !== currentBlock.calculateHash()) {
        return false;
      }

      // Check if our block point to the correct previus block
      if (currentBlock.previousHash !== previousBlock.hash) {
        return false;
      }
    }

    return true;
  }
}

// Let's test it

let glopcoin = new Blockchain();
glopcoin.addBlock(new Block(1, "11/03/2019", { amount: 4 }));
glopcoin.addBlock(new Block(2, "11/03/2019", { amount: 10 }));

console.log('Is blockchain valid? ' + glopcoin.isChainValid());
console.log(JSON.stringify(glopcoin, null, 4));
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Block.html">Block</a></li><li><a href="Blockchain.html">Blockchain</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addBlock">addBlock</a></li><li><a href="global.html#calculateHash">calculateHash</a></li><li><a href="global.html#createGenesisBlock">createGenesisBlock</a></li><li><a href="global.html#getLatestBlock">getLatestBlock</a></li><li><a href="global.html#isChainValid">isChainValid</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.2</a> on Tue May 14 2019 16:10:20 GMT-0500 (-05)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
